<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸš€ Getting Started</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/style.css" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/pilcrow.css" />
  <link type="text/css" rel="stylesheet" href="/Podium/docs/assets/hljs-github.min.css"/>
  <link type="text/css" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/2.10.0/github-markdown.min.css"/>
  <link rel="shortcut icon" href="/Podium/docs/assets/podium.png" type="image/x-icon">
</head>
<body>
  <header>
    <a class="logo" href="/Podium">
      <img class="podium" src="/Podium/docs/assets/podium.png">
      Podium
    </a>
    <div class="links">
      <a href="https://github.schibsted.io/Podium" target="_blank">GitHub</a>
    </div>
  </header>
  <div class="content">
    <nav class="main-navigation">
      
      <h3>Podium</h3>
      <ul>
        <li><a href="/Podium/docs/podium/conceptual_overview.html">ğŸ“š Overview</a></li>
      </ul>
      
      <h3>Podlet Guides</h3>
      <ul>
        <li><a href="/Podium/docs/podlets/getting_started.html">ğŸš€ Getting Started</a></li>
        <li><a href="/Podium/docs/podlets/fallbacks.html">ğŸ”Œ Fallbacks</a></li>
        <li><a href="/Podium/docs/podlets/context.html">âœ‚ï¸ Context</a></li>
        <li><a href="/Podium/docs/podlets/proxying.html">ğŸ  Proxying</a></li>
        <li><a href="/Podium/docs/podlets/local_development.html">ğŸ”¥ Development</a></li>
      </ul>

      <h3>Layout Guides</h3>
      <ul>
        <li><a href="/Podium/docs/layouts/getting_started.html">ğŸš€ Getting Started</a></li>
        <li><a href="/Podium/docs/layouts/context.html">âœ‚ï¸ Context</a></li>
        <li><a href="/Podium/docs/layouts/unavailable_podlets.html">ğŸ”Œ Unavailable Podlets</a></li>
        <li><a href="/Podium/docs/layouts/dynamic_routes.html">ğŸ  Dynamic Routes</a></li>
        <li><a href="/Podium/docs/layouts/assets.html">ğŸ“¦ Assets</a></li>
        <li><a href="/Podium/docs/layouts/local_development.html">ğŸ”¥ Development</a></li>
      </ul>

      <h3>API Docs</h3>
      <ul>
        <li><a href="https://github.schibsted.io/Podium/podlet/blob/master/README.md">ğŸ“š Podlet</a></li>
        <li><a href="https://github.schibsted.io/Podium/layout/blob/master/README.md">ğŸ“š Layout</a></li>
        <li><a href="https://github.schibsted.io/Podium/context/blob/master/README.md">ğŸ“š Context</a></li>
        <li><a href="https://github.schibsted.io/Podium/proxy/blob/master/README.md">ğŸ“š Proxy</a></li>
        <li><a href="https://github.schibsted.io/Podium/client/blob/master/README.md">ğŸ“š Client</a></li>
      </ul>
    </nav>
    <main class="markdown-body"><h1 id="ğŸš€-getting-started"><a class="header-link" href="#ğŸš€-getting-started"></a>ğŸš€ Getting Started</h1>
<p>This guide will walk you through how to get started building layouts for Podium in Node
js using the express js HTTP framework. At the end you will have created a fairly bare bones page displaying content from a single podlet server.</p>
<h2 id="before-you-begin"><a class="header-link" href="#before-you-begin"></a>Before you begin</h2>
<p>Ideally, you should have some familiarity with building apps with javascript and
node.js. You will also need to have node.js installed at version 8 or higher.
The npm cli will be installed automatically when you install node.js. Additionally, you should familiarize yourself with the Podium&#39;s <a href="/Podium/docs/podium/conceptual_overview.html">high level concepts</a> and understand <a href="/Podium/docs/podlets/getting_started.html">how to build a podlet</a> with Podium.</p>
<h2 id="step-1:-project-setup"><a class="header-link" href="#step-1:-project-setup"></a>Step 1: Project setup</h2>
<p>First, we need to initialize a new node project in an empty directory.</p>
<p><em>Example</em></p>
<pre class="hljs"><code>mkdir basic-layout
<span class="hljs-built_in">cd</span> basic-layout
npm init</code></pre><p>Follow the prompts (mostly accepting defaults) to complete project
initialization.</p>
<h2 id="step-2:-install-dependencies"><a class="header-link" href="#step-2:-install-dependencies"></a>Step 2: Install dependencies</h2>
<p>Next, we need to install and import our dependencies, <code>express</code> and
<code>@podium/layout</code>. To do so, run:</p>
<p><em>Example</em></p>
<pre class="hljs"><code>npm install express @podium/layout</code></pre><h2 id="step-3:-import-dependencies"><a class="header-link" href="#step-3:-import-dependencies"></a>Step 3: Import dependencies</h2>
<p>Create a file <code>index.js</code>, open it in your favorite text editor and import our 2 dependencies at the top of the file.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);</code></pre><h2 id="step-4:-instantiate-instances"><a class="header-link" href="#step-4:-instantiate-instances"></a>Step 4: Instantiate instances</h2>
<p>Create an express app instance and instantiate the layout. <code>name</code> and <code>pathname</code> are required parameters. <code>name</code> must be a unique identifier in camel casing. <code>pathname</code> is a prefix path to where your layout will appear online. For our example here we can say that our page will be served at <code>/demo</code> so <code>pathname</code> should be set to <code>/demo</code>. If our page were being served at the root of the server, <code>pathname</code> would need to be <code>/</code>.</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> app = express();

<span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>, <span class="hljs-comment">// required</span>
    pathname: <span class="hljs-string">'/demo'</span>, <span class="hljs-comment">// required</span>
});</code></pre><h2 id="step-5:-register-a-basic-podlet-for-use-in-the-page"><a class="header-link" href="#step-5:-register-a-basic-podlet-for-use-in-the-page"></a>Step 5: Register a basic podlet for use in the page</h2>
<p>For this step, we can use the podlet we created in the <a href="/Podium/docs/podlets/getting_started.html">podlets - getting started</a> guide. It&#39;s set up to run on port <code>7100</code> so after we start it up, we can register our podlet&#39;s manifest file in our layout like so:</p>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> podlet = layout.client.register({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodlet'</span>, <span class="hljs-comment">// required</span>
    uri: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>, <span class="hljs-comment">// required</span>
});</code></pre><p>The <code>uri</code> here should point to the podlet&#39;s manifest file, not to its server root.</p>
<h2 id="step-6:-mount-middleware"><a class="header-link" href="#step-6:-mount-middleware"></a>Step 6: Mount middleware</h2>
<p>Mount the layout instances middleware into the express app. This important step adds layout specific middleware to the app to take care of such tasks as context parsing and proxying.</p>
<p><em>Example</em></p>
<pre class="hljs"><code>app.use(layout.middleware());</code></pre><h2 id="step-7:-create-a-route-to-fetch-and-display-a-podlet's-content"><a class="header-link" href="#step-7:-create-a-route-to-fetch-and-display-a-podlet's-content"></a>Step 7: Create a route to fetch and display a podlet&#39;s content</h2>
<p>This is the route that the layout server will use to return its html page. We create our route using the same <code>pathname</code> value we gave the layout constructor.</p>
<p>In our route handler, we grab the Podium context from the response object and hand it to the fetch method of our <code>podlet</code> podlet client. This method returns a promise which resolves to be the podlet&#39;s content which we can then insert into our page as shown below:</p>
<p><em>Example</em></p>
<pre class="hljs"><code>app.get(<span class="hljs-string">'/demo'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> ctx = res.locals.podium.context;
        <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> podlet.fetch(ctx);

        res.status(<span class="hljs-number">200</span>).send(<span class="hljs-string">`
            &lt;html&gt;
            &lt;head&gt;&lt;title&gt;Demo page&lt;/title&gt;&lt;/head&gt;
            &lt;body&gt;<span class="hljs-subst">${content}</span>&lt;/body&gt;
            &lt;/html&gt;
        `</span>);
    } <span class="hljs-keyword">catch</span> (err) {
        res.sendStatus(<span class="hljs-number">500</span>);
    }
});</code></pre><p>In a more realistic example, you might fetch content from any number of podlets. Your page might be broken up into podlets representing the page header, footer, sidebar and so on. Since podlets are isolated and independent of each other, we can safely fetch content in parallel.</p>
<p><em>Example</em></p>
<pre class="hljs"><code>app.get(<span class="hljs-string">'/'</span>, (req, res) =&gt; {
    <span class="hljs-keyword">const</span> ctx = res.locals.podium.context;
    <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> <span class="hljs-built_in">Promise</span>.all([
        header.fetch(ctx),
        sidebar.fetch(ctx),
        podlet.fetch(ctx),
        footer.fetch(ctx),
    ]);
    ...
});</code></pre><h2 id="step-8:-start-the-server"><a class="header-link" href="#step-8:-start-the-server"></a>Step 8: Start the server</h2>
<p>Now, all thats left is to start the server and test it out</p>
<p><em>Example</em></p>
<pre class="hljs"><code>app.listen(<span class="hljs-number">7000</span>);</code></pre><p>We call <code>.listen(port)</code> on the express app instance and pass it a port</p>
<p>We can run the app with:</p>
<p><em>Example</em></p>
<pre class="hljs"><code>node index.js</code></pre><p>And we can then visit our page in a browser at:</p>
<p><em>Example</em></p>
<pre class="hljs"><code>http://localhost:7000/demo</code></pre><p>If you see the text &quot;This is the podlets html content&quot; then you&#39;ve successfully created your first layout.</p>
<h2 id="the-complete-code"><a class="header-link" href="#the-complete-code"></a>The complete code</h2>
<p><em>Example</em></p>
<pre class="hljs"><code><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">'express'</span>);
<span class="hljs-keyword">const</span> Layout = <span class="hljs-built_in">require</span>(<span class="hljs-string">'@podium/layout'</span>);

<span class="hljs-keyword">const</span> app = express();

<span class="hljs-keyword">const</span> layout = <span class="hljs-keyword">new</span> Layout({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'myLayout'</span>,
    <span class="hljs-attr">pathname</span>: <span class="hljs-string">'/demo'</span>,
});

<span class="hljs-keyword">const</span> podlet = layout.client.register({
    <span class="hljs-attr">name</span>: <span class="hljs-string">'myPodlet'</span>,
    <span class="hljs-attr">uri</span>: <span class="hljs-string">'http://localhost:7100/manifest.json'</span>,
});

app.use(layout.middleware());

app.get(<span class="hljs-string">'/demo'</span>, <span class="hljs-keyword">async</span> (req, res) =&gt; {
    <span class="hljs-keyword">try</span> {
        <span class="hljs-keyword">const</span> ctx = res.locals.podium.context;
        <span class="hljs-keyword">const</span> content = <span class="hljs-keyword">await</span> podlet.fetch(ctx);

        res.status(<span class="hljs-number">200</span>).send(<span class="hljs-string">`
            &lt;html&gt;
            &lt;head&gt;&lt;title&gt;Demo page&lt;/title&gt;&lt;/head&gt;
            &lt;body&gt;<span class="hljs-subst">${content}</span>&lt;/body&gt;
            &lt;/html&gt;
        `</span>);
    } <span class="hljs-keyword">catch</span> (err) {
        res.sendStatus(<span class="hljs-number">500</span>);
    }
});

app.listen(<span class="hljs-number">7000</span>);</code></pre><h2 id="next-steps"><a class="header-link" href="#next-steps"></a>Next steps</h2>
<ul class="list">
<li><a href="/Podium/docs/layouts/unavailable_podlets.html">learn about handling podlet unavailability</a></li>
<li><a href="/Podium/docs/layouts/context.html">learn about forwarding the Podium context to podlets</a></li>
<li><a href="/Podium/docs/layouts/sharing_state.html">learn about sharing state between podlets via the URL</a></li>
<li><a href="/Podium/docs/layouts/assets.html">learn about options for including client side assets</a></li>
<li><a href="/Podium/docs/layouts/local_development.html">read about setting up a layout development workflow</a></li>
</ul>
    </main>
  </div>
  <script>
    (function () {
      var pathname = window.location.pathname.substr(1);
      var activeLink = document.querySelector('a[href$="' + pathname + '"]');

      activeLink.classList.add('selected');
    })();
  </script>
</body>
</html>
