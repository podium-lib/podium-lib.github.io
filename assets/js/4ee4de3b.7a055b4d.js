"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[4241],{5530:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>r,toc:()=>d});var a=n(5893),o=n(1151);const s={id:"unavailable_podlets",title:"Handling podlet unavailability"},i=void 0,r={id:"layout/unavailable_podlets",title:"Handling podlet unavailability",description:"Podium is designed to anticipate and handle the possibility that 1 or more of your podlets may respond slowly or become unavailable from time to time. It does so via the concept of fallbacks.",source:"@site/docs/layout/unavailable_podlets.md",sourceDirName:"layout",slug:"/layout/unavailable_podlets",permalink:"/docs/layout/unavailable_podlets",draft:!1,unlisted:!1,editUrl:"https://github.com/podium-lib/podium-lib.github.io/tree/main/website/docs/docs/layout/unavailable_podlets.md",tags:[],version:"current",frontMatter:{id:"unavailable_podlets",title:"Handling podlet unavailability"},sidebar:"sidebar",previous:{title:"The Podium Context",permalink:"/docs/layout/context"},next:{title:"Passing URL params and query string values to podlets",permalink:"/docs/layout/dynamic_routes"}},l={},d=[{value:"Defining a podlet as throwable",id:"defining-a-podlet-as-throwable",level:2},{value:"Defining a podlet as redirectable",id:"defining-a-podlet-as-redirectable",level:2}];function c(e){const t={a:"a",code:"code",em:"em",h2:"h2",p:"p",pre:"pre",...(0,o.a)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.p,{children:"Podium is designed to anticipate and handle the possibility that 1 or more of your podlets may respond slowly or become unavailable from time to time. It does so via the concept of fallbacks.\nWhen a podlet is first fetched, the layout client will cache a copy of the podlet's fallback content (if defined). If, at a later stage, the layout client cannot fetch the podlet's content, it will instead use the podlet's cached fallback content or just an empty string if no fallback content is available. This means that a layout can go on serving requests with the content it can fetch rather than itself become unavailable."}),"\n",(0,a.jsx)(t.p,{children:"By default, a layout will substitute a fallback (or empty string) for a podlet's content whenever either the podlet fails to respond with a 2xx status code or the podlet fails to respond within 1000 ms. This default timeout value can be configured by passing options to the layout constructor."}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"const layout = new Layout({\n    ...\n    client: {\n        timeout: 2000,\n    }\n});\n"})}),"\n",(0,a.jsx)(t.h2,{id:"defining-a-podlet-as-throwable",children:"Defining a podlet as throwable"}),"\n",(0,a.jsx)(t.p,{children:"In some cases it may make no sense to show a page if some of its content is not available. In such cases, you may prefer for the layout to show an error page rather than fallback content or an empty string. This is especially true for dynamic content that is the main focus of a page. If all you can show is a header and footer, it might be better to show an error page explaining the situation to the user."}),"\n",(0,a.jsxs)(t.p,{children:["In order to facilitate this, it is possible to set a podlet as ",(0,a.jsx)(t.code,{children:"throwable"})," when it is registered."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.em,{children:"Example"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"const gettingStarted = layout.client.register({\n    ...\n    throwable: true,\n})\n"})}),"\n",(0,a.jsx)(t.p,{children:"When the Podium client makes a fetch to the podlet, if that podlet is not available, then the fetch call will reject with an error that you can then handle as you see fit."}),"\n",(0,a.jsxs)(t.p,{children:["Error objects are instances of ",(0,a.jsx)(t.a,{href:"https://www.npmjs.com/package/@hapi/boom",children:"Boom"})," errors and are decorated with the HTTP status code from the podlet response."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.em,{children:"Example"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"app.get('/', (req, res, next) => {\n    try {\n        const content = await gettingStarted.fetch(res.locals.podium);\n        ...\n    } catch(err) {\n        // you might handle this directly...\n        // res.status(err.statusCode).end();\n\n        // or perhaps just pass the error on to be handled in error handling middleware\n        // next(err);\n    }\n});\n"})}),"\n",(0,a.jsx)(t.h2,{id:"defining-a-podlet-as-redirectable",children:"Defining a podlet as redirectable"}),"\n",(0,a.jsxs)(t.p,{children:["In the case that a podlet responds with a ",(0,a.jsx)(t.code,{children:"3xx"})," redirect status code, by default, the Podium client will simply follow the redirect and return the content from the redirect. In some cases, you may wish to handle this redirect manually in your layout app."]}),"\n",(0,a.jsxs)(t.p,{children:["To do so, set ",(0,a.jsx)(t.code,{children:"redirectable"})," to ",(0,a.jsx)(t.code,{children:"true"})," when registering the podlet and then check the response of calls to ",(0,a.jsx)(t.code,{children:"fetch"})," for the ",(0,a.jsx)(t.code,{children:"redirect"})," property. If ",(0,a.jsx)(t.code,{children:"redirect"})," is truthy then the podlet responded with a redirect. The ",(0,a.jsx)(t.code,{children:"redirect"})," property then will contain an object with keys ",(0,a.jsx)(t.code,{children:"statusCode"})," and ",(0,a.jsx)(t.code,{children:"location"})," which you can use to perform your own redirects."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.em,{children:"Example"})}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-js",children:"const gettingStarted = layout.client.register({\n    ...\n    redirectable: true,\n});\n\napp.get('/', async (req, res, next) => {\n    const response = await gettingStarted.fetch(res.locals.podium);\n    if (response.redirect) {\n        res.redirect(response.redirect.statusCode, response.redirect.location);\n    } else {\n        res.podiumSend(response.content);\n    }\n});\n"})})]})}function h(e={}){const{wrapper:t}={...(0,o.a)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},1151:(e,t,n)=>{n.d(t,{Z:()=>r,a:()=>i});var a=n(7294);const o={},s=a.createContext(o);function i(e){const t=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:i(e.components),a.createElement(s.Provider,{value:t},e.children)}}}]);